<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PKM Kaben - Satu Data</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    
    <!-- CSS untuk Print -->
    <style>
        @media print {
            body * {
                visibility: hidden;
            }
            #results, #results * {
                visibility: visible;
            }
            #printBtn, #analyzeBtn, #loadingIndicator, .print-hide {
                display: none !important;
            }
            #results {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                background: white;
                padding: 20px;
            }
            .print-full-width {
                width: 100% !important;
            }
            /* Atur mode landscape */
            @page {
                size: landscape;
            }
            /* Pastikan tabel tidak terpotong */
            table {
                width: 100% !important;
                table-layout: auto !important;
                page-break-inside: avoid;
            }
            /* Hindari pemotongan baris tabel */
            tr {
                page-break-inside: avoid;
            }
            /* Pastikan semua sel terlihat */
            td, th {
                white-space: normal !important;
                overflow: visible !important;
                font-size: 10pt !important;
            }
            /* Atur agar chart terlihat penuh */
            #chartArea {
                max-width: 100% !important;
                width: 100% !important;
                height: auto !important;
                max-height: 500px !important;
                page-break-inside: avoid;
            }
            /* Atur overflow untuk data yang lebar */
            #tableArea {
                overflow: visible !important;
                width: 100% !important;
            }
        }
        .print-only {
            display: none;
        }
        @media print {
            .print-only {
                display: block;
            }
        }
    </style>
</head>
<body class="bg-gray-100">

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">

            <div class="flex justify-between items-center h-16">
                <button class="bg-gray-300 rounded-md py-[5px]">
                    <a href="/dashboard">
                    <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-purple-600 px-4 hover:scale-110 transition-all duration-300">Dashboard</h1></a>
                </button>
                <button id="importFileBtn" 
                        class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2">
                    <span class="flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3-3m0 0l3 3m-3-3v12" />
                        </svg>
                        Import Data
                    </span>
                </button>
            </div>
            

            <!-- Filter Section -->
            <div class="bg-white rounded-lg shadow p-6 mb-6 ">
                <h2 class="text-lg font-semibold mb-4">Filter & Analisis</h2>
                
                <!-- Variable Groups -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    @foreach($variableGroups as $groupKey => $group)
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="text-md font-medium text-gray-700 mb-3">{{ $group['title'] }}</h3>
                            <div class="space-y-3">
                                @foreach($group['variables'] as $key => $variable)
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">
                                            {{ $variable['label'] }}
                                        </label>

                                        @if($variable['type'] === 'select')
                                            <select name="filters[{{ $key }}]" 
                                                    class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                                <option value="">Semua</option>
                                                @foreach($variable['options'] as $optionKey => $optionLabel)
                                                    <option value="{{ $optionKey }}">{{ $optionLabel }}</option>
                                                @endforeach
                                            </select>

                                        @elseif($variable['type'] === 'boolean')
                                            <div class="space-y-2">
                                                <label class="inline-flex items-center">
                                                    <input type="radio" name="filters[{{ $key }}]" 
                                                           value="" class="text-blue-600" checked>
                                                    <span class="ml-2">Semua</span>
                                                </label>
                                                @foreach($variable['options'] as $optionKey => $optionLabel)
                                                    <label class="inline-flex items-center">
                                                        <input type="radio" name="filters[{{ $key }}]" 
                                                               value="{{ $optionKey }}" class="text-blue-600">
                                                        <span class="ml-2">{{ $optionLabel }}</span>
                                                    </label>
                                                @endforeach
                                            </div>

                                        @elseif($variable['type'] === 'range')
                                            <select name="filters[{{ $key }}]" 
                                                    class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                                <option value="">Semua</option>
                                                @foreach($variable['options'] as $optionKey => $optionLabel)
                                                    <option value="{{ $optionKey }}">{{ $optionLabel }}</option>
                                                @endforeach
                                            </select>

                                        @elseif($variable['type'] === 'number')
                                            <input type="number" name="filters[{{ $key }}]"
                                                   class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                                   placeholder="Masukkan nomor...">
                                        @endif
                                    </div>
                                @endforeach
                            </div>
                        </div>
                    @endforeach
                </div>

                <!-- Visualization Type -->
                {{-- <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        Tipe Visualisasi
                    </label>
                    <select id="visualizationType" 
                            class="w-full md:w-1/3 rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                        @foreach($visualizationTypes as $key => $label)
                            <option value="{{ $key }}">{{ $label }}</option>
                        @endforeach
                    </select>
                </div> --}}

                <!-- Buttons for analyze and print -->
                <div class="flex space-x-3">
                    <button id="analyzeBtn" 
                            class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        Analisis Data
                    </button>
                    {{-- <button id="printBtn" 
                            class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 hidden">
                        <span class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                            </svg>
                            Cetak Hasil
                        </span>
                    </button> --}}
                    <button id="exportExcelBtn" 
                            class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 hidden">
                        <span class="flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            Export Excel
                        </span>
                    </button>
                </div>
            </div>

            <!-- Results Section -->
            <div id="results" class="bg-white rounded-lg shadow p-6">
                <div id="loadingIndicator" class="hidden">
                    <div class="flex items-center justify-center p-4">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                        <span class="ml-2">Menganalisis data...</span>
                    </div>
                </div>
                <div id="chartArea" class="min-h-[5px]"></div>
                <div id="tableArea" class="overflow-x-auto"></div>
            </div>
        </main>
    </div>

    <script>
        $(document).ready(function() {
            // Sembunyikan tombol print dan export Excel pada awal halaman
            $('#printBtn').addClass('hidden');
            $('#exportExcelBtn').addClass('hidden');
            
            // Tambahkan event handler untuk tombol print
            $('#printBtn').click(function() {
                printResults();
            });
            
            $('#analyzeBtn').click(function() {
                const filters = {};
                
                // Collect all filter values
                $('select[name^="filters"], input[name^="filters"]:checked, input[type="number"][name^="filters"]').each(function() {
                    const name = $(this).attr('name').match(/\[(.*?)\]/)[1];
                    const value = $(this).val();
                    if (value !== '') {
                        filters[name] = value;
                    }
                });

                $('#loadingIndicator').removeClass('hidden');
                $('#chartArea, #tableArea').empty();
                
                // Sembunyikan tombol print saat memulai analisis baru
                $('#printBtn').addClass('hidden');

                $.ajax({
                    url: '{{ route("analysis.analyze") }}',
                    method: 'POST',
                    data: {
                        _token: '{{ csrf_token() }}',
                        filters: filters,
                        visualization_type: $('#visualizationType').val()
                    },
                    success: function(response) {
                        $('#loadingIndicator').addClass('hidden');
                        if (response.success) {
                            renderVisualization(response.data);
                            // Simpan data analisis untuk digunakan saat export
                            window.analysisData = response.data;
                            
                            // Tampilkan tombol print dan export Excel setelah visualisasi berhasil dirender
                            $('#printBtn').removeClass('hidden');
                            $('#exportExcelBtn').removeClass('hidden');
                        } else {
                            alert('Gagal menganalisis data: ' + response.message);
                            // Sembunyikan tombol print dan export Excel jika analisis gagal
                            $('#printBtn').addClass('hidden');
                            $('#exportExcelBtn').addClass('hidden');
                        }
                    },
                    error: function(xhr) {
                        $('#loadingIndicator').addClass('hidden');
                        console.error('Analysis Error:', xhr.responseJSON);
                        alert('Terjadi kesalahan dalam analisis: ' + (xhr.responseJSON?.message || 'Unknown error'));
                        // Sembunyikan tombol print dan export Excel jika terjadi error
                        $('#printBtn').addClass('hidden');
                        $('#exportExcelBtn').addClass('hidden');
                    }
                });
            });

            // Fungsi untuk mencetak hasil analisis
            function printResults() {
                const currentDate = new Date().toLocaleDateString('id-ID');
                const currentTime = new Date().toLocaleTimeString('id-ID');
                const timestamp = `Dicetak pada: ${currentDate} ${currentTime}`;
                
                // Dapatkan informasi filter yang digunakan
                const filterInfo = getActiveFiltersInfo();
                
                // Tambahkan header print yang berisi informasi timestamp dan filter
                const printHeader = `
                    <div class="print-only mb-4">
                        <h1 class="text-xl font-bold mb-2">Hasil Analisis Data PKM Kaben</h1>
                        <p class="text-sm text-gray-600">${timestamp}</p>
                        ${filterInfo ? `<div class="text-sm text-gray-600 mt-2">Filter yang digunakan: ${filterInfo}</div>` : ''}
                    </div>
                `;
                
                // Masukkan header print ke dalam hasil
                $('.print-only').remove(); // Hapus header yang mungkin sudah ada
                $('#results').prepend(printHeader);
                
                // Persiapkan elemen sebelum print
                prepareChartsForPrinting();
                
                // Print halaman
                window.print();
            }
            
            // Fungsi untuk mendapatkan informasi filter yang aktif
            function getActiveFiltersInfo() {
                const activeFilters = [];
                
                $('select[name^="filters"], input[name^="filters"]:checked, input[type="number"][name^="filters"]').each(function() {
                    const value = $(this).val();
                    if (value !== '' && value !== null) {
                        const name = $(this).attr('name').match(/\[(.*?)\]/)[1];
                        let label = $(`label[for="${$(this).attr('id')}"]`).text().trim();
                        
                        if (!label) {
                            // Coba dapatkan label dari parent label
                            label = $(this).closest('div').find('label').first().text().trim();
                        }
                        
                        // Dapatkan teks opsi untuk select
                        let displayValue = value;
                        if ($(this).is('select')) {
                            displayValue = $(this).find('option:selected').text();
                        }
                        
                        activeFilters.push(`${label}: ${displayValue}`);
                    }
                });
                
                return activeFilters.join(', ');
            }
            
            // Fungsi untuk mempersiapkan chart untuk printing
            function prepareChartsForPrinting() {
                // Jika menggunakan visualisasi chart
                if ($('#chartArea svg').length > 0) {
                    // Pastikan chart terlihat penuh saat cetak
                    $('#chartArea').addClass('print-full-width');
                    
                    // Jika ada chart yang dirender oleh ApexCharts, pastikan terlihat saat print
                    if (typeof ApexCharts !== 'undefined') {
                        // ApexCharts mungkin perlu dirender ulang untuk ukuran print
                        $('.apexcharts-canvas').css('width', '100%');
                    }
                }
                
                // Jika menggunakan tabel, pastikan tidak terpotong
                if ($('#tableArea table').length > 0) {
                    $('#tableArea').addClass('print-full-width');
                    $('#tableArea table').addClass('print-full-width');
                    
                    // Hapus whitespace-nowrap untuk memungkinkan teks wrap
                    $('#tableArea td, #tableArea th').removeClass('whitespace-nowrap');
                }
            }

            function renderVisualization(data) {
                switch(data.type) {
                    case 'table':
                        renderTable(data);
                        break;
                    case 'bar':
                        renderBarChart(data);
                        break;
                    case 'pie':
                        renderPieChart(data);
                        break;
                    case 'line':
                        renderLineChart(data);
                        break;
                }
            }

            function renderTable(data) {
                const tableHtml = `
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    No
                                </th>
                                ${data.headers.map(header => `
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        ${header}
                                    </th>
                                `).join('')}
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${data.rows.map((row, index) => `
                                <tr>
                                    <td class="px-6 py-4 text-sm text-gray-900">
                                        ${index + 1}
                                    </td>
                                    ${row.map(cell => `
                                        <td class="px-6 py-4 text-sm text-gray-900">
                                            ${cell}
                                        </td>
                                    `).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                $('#tableArea').html(tableHtml);
                $('#chartArea').empty();
            }

            function renderBarChart(data) {
                $('#chartArea').empty();
                $('#tableArea').empty();

                const options = {
                    chart: {
                        type: 'bar',
                        height: 400
                    },
                    series: [{
                        name: data.datasets[0].label,
                        data: data.datasets[0].data
                    }],
                    xaxis: {
                        categories: data.labels
                    },
                    plotOptions: {
                        bar: {
                            horizontal: false,
                            columnWidth: '55%',
                            endingShape: 'rounded'
                        },
                    },
                    dataLabels: {
                        enabled: true
                    },
                    title: {
                        text: data.datasets[0].label,
                        align: 'center'
                    }
                };

                const chart = new ApexCharts(document.querySelector("#chartArea"), options);
                chart.render();
            }

            function renderPieChart(data) {
                $('#chartArea').empty();
                $('#tableArea').empty();

                const options = {
                    chart: {
                        type: 'pie',
                        height: 400
                    },
                    series: data.datasets[0].data,
                    labels: data.labels,
                    title: {
                        text: data.datasets[0].label,
                        align: 'center'
                    }
                };

                const chart = new ApexCharts(document.querySelector("#chartArea"), options);
                chart.render();
            }

            function renderLineChart(data) {
                $('#chartArea').empty();
                $('#tableArea').empty();

                const options = {
                    chart: {
                        type: 'line',
                        height: 400
                    },
                    series: [{
                        name: data.datasets[0].label,
                        data: data.datasets[0].data
                    }],
                    xaxis: {
                        categories: data.labels
                    },
                    title: {
                        text: data.datasets[0].label,
                        align: 'center'
                    },
                    markers: {
                        size: 5
                    }
                };

                const chart = new ApexCharts(document.querySelector("#chartArea"), options);
                chart.render();
            }
            
            // Fungsi untuk mengekspor data ke Excel
            function exportToExcel() {
                console.log("Starting exportToExcel function");
                
                // Pastikan ada data untuk diekspor
                if (!window.analysisData) {
                    alert('Tidak ada data untuk diekspor!');
                    return;
                }
                
                try {
                    const data = window.analysisData;
                    const today = new Date();
                    const dateString = today.toISOString().slice(0, 10);
                    const filename = `PKM_Kaben_Analisis_${dateString}.xlsx`;
                    
                    console.log("Preparing Excel data");
                    
                    // Buat workbook baru
                    const wb = XLSX.utils.book_new();
                    
                    // Tergantung pada tipe data, buat worksheet yang sesuai
                    if (data.type === 'table') {
                        // Untuk tabel, tambahkan data dari tabel ke worksheet
                        const wsData = [
                            data.headers, // header row
                            ...data.rows // data rows
                        ];
                        
                        const ws = XLSX.utils.aoa_to_sheet(wsData);
                        XLSX.utils.book_append_sheet(wb, ws, "Data Analisis");
                    } else {
                        // Untuk chart, buat worksheet dari labels dan data
                        const chartData = [];
                        // Add header row
                        chartData.push(['Label', data.datasets[0].label]);
                        
                        // Add data rows
                        for (let i = 0; i < data.labels.length; i++) {
                            chartData.push([data.labels[i], data.datasets[0].data[i]]);
                        }
                        
                        const ws = XLSX.utils.aoa_to_sheet(chartData);
                        XLSX.utils.book_append_sheet(wb, ws, "Data Visualisasi");
                    }
                    
                    // Tambahkan informasi filter jika ada
                    const activeFilters = getActiveFiltersInfo();
                    if (activeFilters) {
                        const filterSheet = XLSX.utils.aoa_to_sheet([
                            ['Informasi Filter', 'Develope By Thoken Azter'],
                            ['Filter yang digunakan:', activeFilters],
                            ['Tanggal Export:', new Date().toLocaleString('id-ID')]
                        ]);
                        XLSX.utils.book_append_sheet(wb, filterSheet, "Info Filter");
                    }
                    
                    console.log("Writing Excel file");
                    
                    // Ekspor file Excel
                    XLSX.writeFile(wb, filename);
                    console.log("Excel file exported successfully");
                } catch (error) {
                    console.error("Error exporting Excel:", error);
                    alert("Terjadi kesalahan saat mengekspor data: " + error.message);
                }
            }

                // Tambahkan kode ini di dalam $(document).ready(function() {...}) yang sudah ada
                // Fungsi yang akan menangani export ke Excel (bisa diletakkan tepat setelah definisi fungsi exportToExcel)
                window.doExcelExport = function() {
                    // Panggil fungsi exportToExcel yang sudah ada
                    exportToExcel();
                };

                let timerCount = 15;
                let timerInterval;

                // Fungsi untuk memulai timer
                function startConfirmationTimer() {
                    timerCount = 15;
                    $('#timerText').text('Mohon tunggu beberapa saat...');
                    $('#timerCounter').text(timerCount + 's');
                    $('#confirmExportBtn').prop('disabled', true)
                        .addClass('cursor-not-allowed bg-gray-400')
                        .removeClass('bg-blue-600 hover:bg-blue-700');
                    
                    $('#timerProgressBar').css('width', '0%');
                    
                    // Clear any existing timer
                    clearInterval(timerInterval);
                    
                    timerInterval = setInterval(function() {
                        timerCount--;
                        let progressPercent = 100 - (timerCount * 20);
                        $('#timerProgressBar').css('width', progressPercent + '%');
                        $('#timerCounter').text(timerCount > 0 ? timerCount + 's' : '');
                        
                        if (timerCount <= 0) {
                            clearInterval(timerInterval);
                            $('#timerText').text('Anda dapat melanjutkan sekarang');
                            $('#confirmExportBtn').prop('disabled', false)
                                .removeClass('cursor-not-allowed bg-gray-400')
                                .addClass('bg-blue-600 hover:bg-blue-700');
                        } else {
                            $('#timerCounter').text(timerCount + 's');
                        }
                    }, 1000);
                }

                // Inisialisasi event handler untuk tombol export
                $('#exportExcelBtn').off('click').on('click', function() {
                    // Show modal with animation
                    $('#exportConfirmationModal').removeClass('hidden');
                    setTimeout(function() {
                        $('#modalContent').removeClass('opacity-0 translate-y-4');
                    }, 50);
                    startConfirmationTimer();
                });

                // Event handler untuk tombol konfirmasi
                $('#confirmExportBtn').off('click').on('click', function() {
                    if (!$(this).prop('disabled')) {
                        // Hide modal with animation
                        $('#modalContent').addClass('opacity-0 translate-y-4');
                        setTimeout(function() {
                            $('#exportConfirmationModal').addClass('hidden');
                        }, 300);
                        
                        clearInterval(timerInterval);
                        // Panggil fungsi export menggunakan timeout untuk menghindari masalah event
                        setTimeout(window.doExcelExport, 400);
                    }
                });

                // Event handler untuk tombol batal
                $('#cancelExportBtn').off('click').on('click', function() {
                    // Hide modal with animation
                    $('#modalContent').addClass('opacity-0 translate-y-4');
                    setTimeout(function() {
                        $('#exportConfirmationModal').addClass('hidden');
                    }, 300);
                    
                    clearInterval(timerInterval);
                });

                function processImportedData(file) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const data = e.target.result;
                        let importedData;
                        
                        try {
                            if (file.name.endsWith('.csv')) {
                                // Parse CSV menggunakan PapaParse
                                Papa.parse(data, {
                                    header: true,
                                    dynamicTyping: true,
                                    complete: function(results) {
                                        if (results.data && results.data.length > 0) {
                                            // Tampilkan data yang diimpor
                                            displayImportedData(results.data);
                                        } else {
                                            alert('Tidak ada data yang ditemukan dalam file CSV.');
                                        }
                                    },
                                    error: function(error) {
                                        alert('Error saat memproses file CSV: ' + error.message);
                                    }
                                });
                            } else {
                                // Parse Excel
                                const workbook = XLSX.read(data, { type: 'array' });
                                const firstSheetName = workbook.SheetNames[0];
                                const worksheet = workbook.Sheets[firstSheetName];
                                
                                // Konversi ke JSON
                                importedData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                                
                                if (importedData && importedData.length > 0) {
                                    // Asumsikan baris pertama adalah header
                                    const headers = importedData[0];
                                    const rows = importedData.slice(1);
                                    
                                    // Format data untuk ditampilkan
                                    const formattedData = rows.map(row => {
                                        const rowObj = {};
                                        headers.forEach((header, index) => {
                                            rowObj[header] = row[index];
                                        });
                                        return rowObj;
                                    });
                                    
                                    // Tampilkan data yang diimpor
                                    displayImportedData(formattedData);
                                } else {
                                    alert('Tidak ada data yang ditemukan dalam file Excel.');
                                }
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('Error saat memproses file: ' + error.message);
                        }
                    };
                    
                    reader.onerror = function(ex) {
                        console.error(ex);
                        alert("Error saat membaca file: " + ex.message);
                    };
                    
                    if (file.name.endsWith('.csv')) {
                        reader.readAsText(file);
                    } else {
                        reader.readAsArrayBuffer(file);
                    }
                }

                function displayImportedData(data) {
                    // Contoh: Kita akan menampilkan data dalam format tabel
                    
                    // Untuk demo, kita batasi jumlah data yang ditampilkan
                    const displayLimit = Math.min(100, data.length);
                    const displayData = data.slice(0, displayLimit);
                    
                    if (displayData.length === 0) {
                        alert('Tidak ada data yang dapat ditampilkan.');
                        return;
                    }
                    
                    // Dapatkan header dari kunci objek pertama
                    const headers = Object.keys(displayData[0]);
                    
                    // Format data untuk visualisasi
                    const tableData = {
                        type: 'table',
                        headers: headers,
                        rows: displayData.map(row => headers.map(header => row[header] || ''))
                    };
                    
                    // Tampilkan data
                    renderTable(tableData);
                    
                    // Simpan data untuk keperluan export
                    window.analysisData = tableData;
                    
                    // Tampilkan tombol export
                    $('#printBtn').removeClass('hidden');
                    $('#exportExcelBtn').removeClass('hidden');
                    
                    // Scroll ke hasil
                    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                }

                function uploadFile(file) {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('_token', '{{ csrf_token() }}');
    
    $.ajax({
        url: '{{ route("analysis.import") }}',
        method: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        xhr: function() {
            const xhr = new window.XMLHttpRequest();
            xhr.upload.addEventListener('progress', function(e) {
                if (e.lengthComputable) {
                    const percent = Math.round((e.loaded / e.total) * 100);
                    $('#importProgressBar').css('width', percent + '%');
                    $('#importPercentage').text(percent + '%');
                }
            }, false);
            return xhr;
        },
        success: function(response) {
            if (response.success) {
                $('#importStatusText').text('Selesai!');
                setTimeout(function() {
                    $('#importModalContent').addClass('opacity-0 translate-y-4');
                    setTimeout(function() {
                        $('#importFileModal').addClass('hidden');
                        renderTable(response.data);
                        window.analysisData = response.data;
                        $('#printBtn').removeClass('hidden');
                        $('#exportExcelBtn').removeClass('hidden');
                    }, 300);
                }, 500);
            } else {
                alert('Gagal mengimpor data: ' + response.message);
            }
        },
        error: function(xhr) {
            $('#importStatusText').text('Error!');
            console.error('Import Error:', xhr.responseJSON);
            alert('Terjadi kesalahan dalam mengimpor: ' + (xhr.responseJSON?.message || 'Unknown error'));
        }
    });
}


                // Fungsi-fungsi untuk import file
                $(document).ready(function() {
                    // Inisialisasi variabel
                    let selectedFile = null;
                    
                    // Event handler untuk tombol import
                    $('#importFileBtn').click(function() {
                        // Reset form
                        selectedFile = null;
                        $('#selectedFile').addClass('hidden');
                        $('#importProgress').addClass('hidden');
                        $('#confirmImportBtn').prop('disabled', true)
                            .addClass('cursor-not-allowed bg-gray-400')
                            .removeClass('bg-purple-600 hover:bg-purple-700');
                        
                        // Tampilkan modal
                        $('#importFileModal').removeClass('hidden');
                        setTimeout(function() {
                            $('#importModalContent').removeClass('opacity-0 translate-y-4');
                        }, 50);
                    });
                    
                    // Event untuk drop zone
                    const dropZone = document.getElementById('dropZone');
                    const fileInput = document.getElementById('fileInput');
                    
                    // Klik pada drop zone
                    dropZone.addEventListener('click', function() {
                        fileInput.click();
                    });
                    
                    // Handle drag & drop
                    dropZone.addEventListener('dragover', function(e) {
                        e.preventDefault();
                        dropZone.classList.add('border-purple-500');
                    });
                    
                    dropZone.addEventListener('dragleave', function(e) {
                        e.preventDefault();
                        dropZone.classList.remove('border-purple-500');
                    });
                    
                    dropZone.addEventListener('drop', function(e) {
                        e.preventDefault();
                        dropZone.classList.remove('border-purple-500');
                        
                        if (e.dataTransfer.files.length) {
                            handleFile(e.dataTransfer.files[0]);
                        }
                    });
                    
                    // Handle file dipilih dari input
                    fileInput.addEventListener('change', function() {
                        if (fileInput.files.length) {
                            handleFile(fileInput.files[0]);
                        }
                    });
                    
                    // Fungsi untuk menangani file yang dipilih
                    function handleFile(file) {
                        // Validasi tipe file
                        const validTypes = ['application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'text/csv'];
                        if (!validTypes.includes(file.type) && !file.name.endsWith('.csv') && !file.name.endsWith('.xlsx') && !file.name.endsWith('.xls')) {
                            alert('Format file tidak didukung. Silakan pilih file Excel (.xlsx, .xls) atau CSV.');
                            return;
                        }
                        
                        // Tampilkan informasi file
                        selectedFile = file;
                        $('#fileName').text(file.name);
                        $('#fileSize').text(formatFileSize(file.size));
                        $('#selectedFile').removeClass('hidden');
                        
                        // Aktifkan tombol import
                        $('#confirmImportBtn').prop('disabled', false)
                            .removeClass('cursor-not-allowed bg-gray-400')
                            .addClass('bg-purple-600 hover:bg-purple-700');
                    }
                    
                    // Hapus file
                    $('#removeFileBtn').click(function(e) {
                        e.stopPropagation();
                        selectedFile = null;
                        fileInput.value = '';
                        $('#selectedFile').addClass('hidden');
                        $('#confirmImportBtn').prop('disabled', true)
                            .addClass('cursor-not-allowed bg-gray-400')
                            .removeClass('bg-purple-600 hover:bg-purple-700');
                    });
                    
                    // Format ukuran file
                    function formatFileSize(bytes) {
                        if (bytes === 0) return '0 Bytes';
                        const k = 1024;
                        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                        const i = Math.floor(Math.log(bytes) / Math.log(k));
                        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                    }
                    
                    // Event handler untuk tombol konfirmasi import
                    $('#confirmImportBtn').click(function() {
                        if (selectedFile) {
                            importFile(selectedFile);
                        }
                    });
                    
                    // Event handler untuk tombol batal
                    $('#cancelImportBtn').click(function() {
                        // Sembunyikan modal
                        $('#importModalContent').addClass('opacity-0 translate-y-4');
                        setTimeout(function() {
                            $('#importFileModal').addClass('hidden');
                        }, 300);
                    });
                    
                    // Fungsi untuk mengimpor file
                    function importFile(file) {
                        // Tampilkan progress bar
                        $('#importProgress').removeClass('hidden');
                        $('#importStatusText').text('Membaca file...');
                        $('#importPercentage').text('0%');
                        $('#importProgressBar').css('width', '0%');
                        
                        // Simulasi progress (dalam aplikasi nyata, ini akan diperbarui saat file dibaca)
                        let progress = 0;
                        const progressInterval = setInterval(function() {
                            progress += 5;
                            if (progress > 100) {
                                clearInterval(progressInterval);
                                return;
                            }
                            
                            $('#importProgressBar').css('width', progress + '%');
                            $('#importPercentage').text(progress + '%');
                            
                            if (progress === 30) {
                                $('#importStatusText').text('Menganalisis data...');
                            } else if (progress === 60) {
                                $('#importStatusText').text('Memproses...');
                            } else if (progress === 90) {
                                $('#importStatusText').text('Hampir selesai...');
                            } else if (progress === 100) {
                                $('#importStatusText').text('Selesai!');
                                
                                // Sembunyikan modal setelah selesai
                                setTimeout(function() {
                                    $('#importModalContent').addClass('opacity-0 translate-y-4');
                                    setTimeout(function() {
                                        $('#importFileModal').addClass('hidden');
                                        processImportedData(file);
                                    }, 300);
                                }, 500);
                            }
                        }, 100);
                        
                        // Di sini Anda akan membaca file menggunakan FileReader API
                        // dan memproses data menggunakan SheetJS (xlsx)
                        readFile(file);
                    }
                    
                    // Fungsi untuk membaca file
                    function readFile(file) {
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            const data = e.target.result;
                            // Untuk aplikasi nyata, Anda akan memproses data di sini
                            console.log("File loaded successfully");
                        };
                        
                        reader.onerror = function(ex) {
                            console.error(ex);
                            alert("Error saat membaca file: " + ex.message);
                        };
                        
                        if (file.name.endsWith('.csv')) {
                            reader.readAsText(file);
                        } else {
                            reader.readAsArrayBuffer(file);
                        }
                    }
                    
                    // Fungsi untuk memproses data yang diimpor
                    function processImportedData(file) {
                        // Di sini Anda akan menggunakan XLSX dan data yang sudah dibaca
                        // untuk memproses data dan menampilkannya di aplikasi
                        
                        // Untuk demo, kita hanya tampilkan alert bahwa impor berhasil
                        alert('File ' + file.name + ' berhasil diimpor!');
                        
                        // Dalam aplikasi nyata, Anda akan mengirim data ke server atau
                        // langsung memprosesnya di client-side menggunakan XLSX.js
                    }
                });

        });
    </script>


<!-- Script untuk modal notifikasi (tambahkan di dalam script yang ada) -->
<script>
    $(document).ready(function() {
        // Periksa apakah notifikasi sudah pernah ditampilkan dan disembunyikan
        const dontShowNotification = localStorage.getItem('dontShowWelcomeNotification');
        
        // Jika pengguna belum memilih untuk tidak menampilkan lagi, tampilkan modal
        if (dontShowNotification !== 'true') {
            // Tampilkan modal setelah halaman dimuat dengan sedikit delay
            setTimeout(function() {
                $('#welcomeNotificationModal').removeClass('hidden');
            }, 1000); // Modal akan muncul setelah 1 detik
        }
        
        // Handler untuk tombol OK
        $('#okNotificationBtn, #closeNotificationBtn').click(function() {
            // Sembunyikan modal
            $('#welcomeNotificationModal').addClass('hidden');
            
            // Jika checkbox dicentang, simpan preferensi untuk tidak menampilkan lagi
            if ($('#dontShowAgain').is(':checked')) {
                localStorage.setItem('dontShowWelcomeNotification', 'true');
            }
        });
        
        // Fungsi untuk mengubah pesan notifikasi
        function setNotificationMessage(options) {
            if (!options) return;
            
            // Set judul jika ada
            if (options.title) {
                $('#welcomeNotificationModal h3').text(options.title);
            }
            
            // Set heading pesan jika ada
            if (options.heading) {
                $('#welcomeNotificationModal h4').text(options.heading);
            }
            
            // Set konten pesan jika ada
            if (options.message) {
                $('.notification-message').html(options.message);
            }
            
            // Set versi jika ada
            if (options.version) {
                $('.notification-message span.font-semibold').text(options.version);
            }
        }
        
        // Contoh penggunaan (Anda bisa menghapus atau memodifikasi ini)
        // setNotificationMessage({
        //     title: "Pengumuman Penting",
        //     heading: "Pembaruan Sistem",
        //     message: "<p>Sistem telah diperbarui dengan fitur-fitur baru.</p><p class='mt-2'>Silakan hubungi admin jika ada pertanyaan.</p>",
        //     version: "2.1.5"
        // });
        
        // Untuk penggunaan API atau dinamis, Anda bisa mengambil pesan dari server
        // $.get('/api/notifications/latest', function(data) {
        //     if (data && data.active) {
        //         setNotificationMessage({
        //             title: data.title,
        //             heading: data.heading,
        //             message: data.message,
        //             version: data.version
        //         });
        //     }
        // });
    });
    </script>


    <div id="exportConfirmationModal" class="fixed inset-0 bg-gray-900 bg-opacity-60 hidden overflow-y-auto h-full w-full backdrop-blur-sm transition-all duration-300" style="z-index: 50;">
        <div class="relative top-20 mx-auto p-0 md:w-[480px] w-[95%] shadow-2xl rounded-xl bg-white transform transition-all duration-300 opacity-0 translate-y-4" id="modalContent">
            <!-- Header dengan grafik -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-700 rounded-t-xl p-5 relative overflow-hidden">
                <div class="absolute -right-8 -top-8 w-32 h-32 bg-indigo-500 bg-opacity-50 rounded-full"></div>
                <div class="absolute -right-4 -bottom-8 w-24 h-24 bg-blue-500 bg-opacity-50 rounded-full"></div>
                
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <h3 class="text-xl font-bold text-white">Konfirmasi Export Data</h3>
                        <p class="text-blue-100 text-sm mt-1">Keamanan dan privasi data</p>
                    </div>
                    <div class="w-12 h-12 flex items-center justify-center rounded-full bg-white bg-opacity-20">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                    </div>
                </div>
            </div>
            
            <!-- Body content -->
            <div class="p-6">
                <div class="flex items-start mb-4">
                    <div class="flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full bg-yellow-100">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                    </div>
                    <div class="ml-4">
                        <h4 class="text-lg font-semibold text-gray-800">Data Sensitif</h4>
                        <p class="text-sm text-gray-600 mt-1">
                            Anda akan mengekspor data yang mungkin mengandung informasi sensitif.
                        </p>
                    </div>
                </div>
                
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <h5 class="font-medium text-gray-700 mb-2">Dengan melanjutkan, Anda menyetujui:</h5>
                    <ul class="space-y-2">
                        <li class="flex items-start">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                            <span class="text-sm text-gray-600">Data ini hanya digunakan untuk keperluan resmi</span>
                        </li>
                        <li class="flex items-start">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                            <span class="text-sm text-gray-600">Data akan disimpan dengan aman dan dilindungi</span>
                        </li>
                        <li class="flex items-start">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-2 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                            <span class="text-sm text-gray-600">Data tidak akan dibagikan kepada pihak yang tidak berwenang</span>
                        </li>
                    </ul>
                </div>
                
                <!-- Timer progress -->
                <div class="mb-5">
                    <div class="flex justify-between items-center mb-1">
                        <span id="timerText" class="text-sm text-gray-500">Harap tunggu 5 detik...</span>
                        <span id="timerCounter" class="text-sm font-medium text-gray-700">5s</span>
                    </div>
                    <div class="w-full h-1.5 bg-gray-200 rounded-full overflow-hidden">
                        <div id="timerProgressBar" class="h-full bg-blue-600 rounded-full transition-all duration-1000" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- Buttons -->
                <div class="flex flex-col sm:flex-row gap-3 sm:justify-end">
                    <button id="cancelExportBtn" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors">
                        Batal
                    </button>
                    <button id="confirmExportBtn" disabled class="px-4 py-2 bg-gray-400 text-white text-sm font-medium rounded-lg shadow-sm hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors cursor-not-allowed">
                        Saya Setuju & Lanjutkan Export
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Modal Notifikasi - Tambahkan di bagian bawah file HTML sebelum penutup body -->
<div id="welcomeNotificationModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden overflow-y-auto h-full w-full" style="z-index: 50;">
    <div class="relative top-20 mx-auto p-5 border md:w-1/3 w-11/12 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex justify-between items-center border-b pb-3">
                <h3 class="text-lg font-semibold text-red-800">Attention</h3>
                <div class="cursor-pointer" id="closeNotificationBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400 hover:text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </div>
            </div>
            
            <div class="mt-4 px-1 py-3">
                <div class="flex items-start">
                    <div class="flex-shrink-0 bg-blue-100 rounded-full p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    
                    <div class="ml-4">
                        <h4 class="text-md font-medium text-gray-800">Harap Bijak Dalam Menggunakan Fitur Yang Tersedia</h4>
                        <div class="mt-2 text-sm text-gray-600 notification-message">
                            <!-- Konten pesan akan diisi melalui JavaScript -->
                            <p class="text-justify">Aplikasi ini digunakan untuk melakukan analisis data kesehatan masyarakat di wilayah kerja Puskesmas Rawat Inap Kabalsiang Benjuring.</p>
                            <p class="mt-2">Versi Beta: <span class="font-semibold">0.0.2</span> (01 Maret 2025)</p>
                            <div class="mt-3 pt-3 border-t border-gray-200">
                                <p class="font-medium">Pembaruan terbaru:</p>
                                <ul class="list-disc pl-5 mt-1 space-y-1">
                                    <li>Penambahan fitur export data ke Excel</li>
                                    <li>Perbaikan filter berdasarkan desa</li>
                                    <li>Penambahan indikator air bersih & sanitasi</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="items-center px-1 py-3 mt-2">
                <div class="flex justify-end">
                    <label class="inline-flex items-center text-sm text-gray-600 mr-4">
                        <input type="checkbox" id="dontShowAgain" class="rounded text-blue-600">
                        <span class="ml-2">Jangan tampilkan lagi</span>
                    </label>
                    <button id="okNotificationBtn" class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        Mengerti
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>


    <!-- Modal Import File -->
    <div id="importFileModal" class="fixed inset-0 bg-gray-900 bg-opacity-60 hidden overflow-y-auto h-full w-full backdrop-blur-sm transition-all duration-300" style="z-index: 50;">
        <div class="relative top-20 mx-auto p-0 md:w-[480px] w-[95%] shadow-2xl rounded-xl bg-white transform transition-all duration-300 opacity-0 translate-y-4" id="importModalContent">
            <!-- Header -->
            <div class="bg-gradient-to-r from-purple-600 to-indigo-700 rounded-t-xl p-5 relative overflow-hidden">
                <div class="absolute -right-8 -top-8 w-32 h-32 bg-indigo-500 bg-opacity-50 rounded-full"></div>
                <div class="absolute -right-4 -bottom-8 w-24 h-24 bg-purple-500 bg-opacity-50 rounded-full"></div>
                
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <h3 class="text-xl font-bold text-white">Import Data</h3>
                        <p class="text-blue-100 text-sm mt-1">Unggah file Excel atau CSV</p>
                    </div>
                    <div class="w-12 h-12 flex items-center justify-center rounded-full bg-white bg-opacity-20">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3-3m0 0l3 3m-3-3v12" />
                        </svg>
                    </div>
                </div>
            </div>
            
            <!-- Body content -->
            <div class="p-6">
                <div class="mb-5">
                    <p class="text-sm text-gray-600 mb-4">
                        Pilih file Excel (.xlsx, .xls) atau CSV untuk diimpor. Data akan dianalisis menggunakan format yang sesuai.
                    </p>
                    
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-purple-500 transition-colors" id="dropZone">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        <p class="mt-2 text-sm text-gray-600">Drag & drop file di sini, atau <span class="text-purple-600 font-medium">pilih file</span></p>
                        <p class="mt-1 text-xs text-gray-500">Format yang didukung: XLSX, XLS, CSV</p>
                        <input type="file" id="fileInput" class="hidden" accept=".xlsx,.xls,.csv">
                    </div>
                    
                    <div id="selectedFile" class="hidden mt-4 p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <div>
                                    <p id="fileName" class="text-sm font-medium text-gray-800">filename.xlsx</p>
                                    <p id="fileSize" class="text-xs text-gray-500">128 KB</p>
                                </div>
                            </div>
                            <button id="removeFileBtn" class="text-gray-400 hover:text-gray-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div id="importProgress" class="hidden mt-4">
                        <div class="flex justify-between items-center mb-1">
                            <span id="importStatusText" class="text-sm text-gray-500">Sedang mengimpor...</span>
                            <span id="importPercentage" class="text-sm font-medium text-gray-700">0%</span>
                        </div>
                        <div class="w-full h-1.5 bg-gray-200 rounded-full overflow-hidden">
                            <div id="importProgressBar" class="h-full bg-purple-600 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Buttons -->
                <div class="flex flex-col sm:flex-row gap-3 sm:justify-end">
                    <button id="cancelImportBtn" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 text-sm font-medium rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors">
                        Batal
                    </button>
                    <button id="confirmImportBtn" disabled class="px-4 py-2 bg-gray-400 text-white text-sm font-medium rounded-lg shadow-sm hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors cursor-not-allowed">
                        Import Data
                    </button>
                </div>
            </div>
        </div>
    </div>


</body>
</html>